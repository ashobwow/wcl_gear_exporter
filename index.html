<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
        <script>
            function getLogsData() {
                let logsResponseTextArea = document.getElementById("logs_response");
                logsResponseTextArea.innerHTML = "";
                document.getElementById("sims_link").innerHTML = "";
                let data;
                if ($("#logs_url").val()) {
                    data = {"logs_url": encodeURIComponent($("#logs_url").val())};
                } else {
                    data = {
                        "report_code": $("#report_code").val(),
                        "fight_id": $("#fight_id").val(),
                        "source_id": $("#source_id").val()
                    };
                }
                $.ajax({
                    url: 'https://3c1b653iwb.execute-api.us-east-1.amazonaws.com/dev/logs_gear_exporter',
                    type: 'GET',
                    data: data,
                    success: function (response) {
                        parse = JSON.parse(response);
                        var cls = parsed.player.class.split('Class')[1].toLowerCase();
                        var spec = Object.keys(parsed.player).find(el => el.toLowerCase().includes(cls))
                        const spec_urls = {
                            balanceDruid: 'https://wowsims.github.io/wotlk/balance_druid/',
                            feralDruid: 'https://wowsims.github.io/wotlk/feral_druid/',
                            mage: 'https://wowsims.github.io/wotlk/mage/',
                            deathknight: 'https://wowsims.github.io/wotlk/deathknight/',
                            hunter: 'https://wowsims.github.io/wotlk/hunter/',
                            retributionPaladin: 'https://wowsims.github.io/wotlk/retribution_paladin/',
                            rogue: 'https://wowsims.github.io/wotlk/rogue/',
                            shadowPriest: 'https://wowsims.github.io/wotlk/shadow_priest/',
                            enhancementShaman: 'https://wowsims.github.io/wotlk/enhancement_shaman/',
                            elementalShaman: 'https://wowsims.github.io/wotlk/elemental_shaman/',
                            warlock: 'https://wowsims.github.io/wotlk/warlock/',
                            warrior: 'https://wowsims.github.io/wotlk/warrior/'
                        }
                        logsResponseTextArea.innerHTML = response;
                        var copyTextButton = document.getElementById("copy_text_button");
                        copyTextButton.innerHTML = "Copy text";
                        document.getElementById("sims_link").innerHTML = '<a href=' + spec_urls[spec] + '>' + spec_urls[spec] + '</a>'
                    }
                });
            };
        </script>
        <script>
            function copyText() {
                // Get the text field
                var copyText = document.getElementById("logs_response");

                // Select the text field
                copyText.select();
                copyText.setSelectionRange(0, 99999); // For mobile devices

                // Copy the text inside the text field
                navigator.clipboard.writeText(copyText.value);
                var copyTextButton = document.getElementById("copy_text_button");
                copyTextButton.innerHTML = "Text copied";
                
            }
        </script>
    </head>
    <body>
        <form id="logs_form" onsubmit="return false;">
            <label for="report_code">Report Code:</label><br>
            <input type="text" id="report_code" name="report_code"><br>
            <label for="fight_id">Fight ID:</label><br>
            <input type="text" id="fight_id" name="fight_id"><br>
            <label for="source_id">Source ID:</label><br>
            <input type="text" id="source_id" name="source_id"><br><br>
            Or enter just the logs urls with the report_code, fight_id, and source_id in it
            e.g. https://classic.warcraftlogs.com/reports/m8z9xadHJMr2qR41#fight=45&source=58
            <label for="logs_url">Logs URL:</label><br>
            <input type="text" id="logs_url" name="logs_url"><br>
            <button onclick="getLogsData()">Submit</button>
            <div id="sims_link"></div>
        </form>
        <textarea id="logs_response"></textarea>
        <button id="copy_text_button" onclick="copyText()">Copy text</button>
    </body>
</html>